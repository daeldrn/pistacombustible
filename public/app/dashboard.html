<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Mi Aplicación</title>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;subset=latin" rel="stylesheet">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet" />
    <link href="/css/nifty.css" rel="stylesheet">
    <link href="/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/plugins/animate-css/animate.min.css" rel="stylesheet">
    <link href="/css/demo/nifty-demo.css" rel="stylesheet">
    <link href="/plugins/pace/pace.min.css" rel="stylesheet">
    <script src="/plugins/pace/pace.min.js"></script>
</head>

<body>
    <div id="container" class="effect mainnav-lg">

        <!--NAVBAR-->
        <header id="navbar">
            <div id="navbar-container" class="boxed">
                <div class="navbar-header">
                    <a href="/app/dashboard.html" class="navbar-brand">
                        <img src="/img/logo.png" alt="Logo" class="brand-icon">
                        <div class="brand-title">
                            <span class="brand-text">Mi Aplicación</span>
                        </div>
                    </a>
                </div>

                <div class="navbar-content clearfix">
                    <ul class="nav navbar-top-links pull-left">
                        <li class="tgl-menu-btn">
                            <a class="mainnav-toggle" href="javascript:void(0);">
                                <i class="fa fa-navicon fa-lg"></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav navbar-top-links pull-right">
                        <li id="dropdown-user" class="dropdown">
                            <a href="#" data-toggle="dropdown" class="dropdown-toggle text-right">
                                <span class="pull-right">
                                    <img class="img-circle img-user media-object" src="/img/av1.png"
                                        alt="Profile Picture">
                                </span>
                                <div class="username hidden-xs" id="userName">Usuario</div>
                            </a>

                            <div class="dropdown-menu dropdown-menu-md dropdown-menu-right panel-default">
                                <ul class="head-list">
                                    <li>
                                        <a href="#"><i class="fa fa-user fa-fw"></i> Perfil</a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="fa fa-cog fa-fw"></i> Configuración</a>
                                    </li>
                                    <li>
                                        <a href="#" id="logoutBtn"><i class="fa fa-sign-out fa-fw"></i> Cerrar
                                            Sesión</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </header>

        <div class="boxed">
            <div id="content-container">
                <div id="page-title">
                    <h1 class="page-header text-overflow">Dashboard</h1>
                </div>

                <div id="page-content">

                    <!-- Estadísticas -->
                    <div class="row">
                        <div class="col-lg-3 col-md-6">
                            <div class="panel panel-primary panel-colorful">
                                <div class="pad-all text-center">
                                    <span class="text-3x text-thin" id="statUsers">0</span>
                                    <p>Usuarios</p>
                                    <i class="fa fa-users fa-3x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="panel panel-info panel-colorful">
                                <div class="pad-all text-center">
                                    <span class="text-3x text-thin" id="statOrders">0</span>
                                    <p>Pedidos</p>
                                    <i class="fa fa-shopping-cart fa-3x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="panel panel-success panel-colorful">
                                <div class="pad-all text-center">
                                    <span class="text-3x text-thin" id="statSales">0</span>
                                    <p>Ventas</p>
                                    <i class="fa fa-line-chart fa-3x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="panel panel-warning panel-colorful">
                                <div class="pad-all text-center">
                                    <span class="text-3x text-thin" id="statMessages">0</span>
                                    <p>Mensajes</p>
                                    <i class="fa fa-envelope fa-3x"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Usuarios Recientes -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel">
                                <div class="panel-heading">
                                    <div class="panel-control">
                                        <a href="/app/users.html" class="btn btn-primary">
                                            <i class="fa fa-users"></i> Ver Todos
                                        </a>
                                    </div>
                                    <h3 class="panel-title">Usuarios Recientes</h3>
                                </div>
                                <div class="panel-body">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Nombre</th>
                                                <th>Email</th>
                                                <th>Estado</th>
                                                <th>Fecha Registro</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentUsersTable">
                                            <tr>
                                                <td colspan="5" class="text-center">Cargando...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!--MAIN NAVIGATION-->
            <nav id="mainnav-container">
                <div id="mainnav">
                    <div id="mainnav-menu-wrap">
                        <div class="nano">
                            <div class="nano-content">
                                <ul id="mainnav-menu" class="list-group">
                                    <li class="list-header">Navegación</li>

                                    <li class="active-link">
                                        <a href="/app/dashboard.html">
                                            <i class="fa fa-dashboard"></i>
                                            <span class="menu-title">Dashboard</span>
                                        </a>
                                    </li>

                                    <li>
                                        <a href="/app/users.html">
                                            <i class="fa fa-users"></i>
                                            <span class="menu-title">Usuarios</span>
                                        </a>
                                    </li>

                                    <li>
                                        <a href="#">
                                            <i class="fa fa-shopping-cart"></i>
                                            <span class="menu-title">Pedidos</span>
                                        </a>
                                    </li>

                                    <li>
                                        <a href="#">
                                            <i class="fa fa-file-text"></i>
                                            <span class="menu-title">Reportes</span>
                                        </a>
                                    </li>

                                    <li>
                                        <a href="#">
                                            <i class="fa fa-cog"></i>
                                            <span class="menu-title">Configuración</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>

        <footer id="footer">
            <div class="hide-fixed pull-right pad-rgt"></div>
            <p class="pad-lft">&#0169; 2026 Mi Aplicación</p>
        </footer>

        <button id="scroll-top" class="btn"><i class="fa fa-chevron-up"></i></button>
    </div>

    <script src="/js/jquery-2.1.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/plugins/fast-click/fastclick.min.js"></script>
    <script src="/js/nifty.js"></script>
    <script>
        const API_URL = '/pista';

        // Verificar autenticación
        function checkAuth() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                window.location.href = '/app/login.html';
                return null;
            }
            return token;
        }

        // Hacer petición autenticada
        async function fetchAPI(endpoint, options = {}) {
            const token = checkAuth();
            if (!token) return;

            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Authorization': `Bearer ${token}`,
                ...options.headers
            };

            try {
                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...options,
                    headers
                });

                if (response.status === 401) {
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('user');
                    window.location.href = '/app/login.html';
                    return null;
                }

                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        // Cargar datos del dashboard
        async function loadDashboard() {
            const data = await fetchAPI('/dashboard');

            if (data && data.success) {
                // Actualizar estadísticas
                const stats = data.data.stats;
                document.getElementById('statUsers').textContent = stats.users;
                document.getElementById('statOrders').textContent = stats.orders;
                document.getElementById('statSales').textContent = stats.sales;
                document.getElementById('statMessages').textContent = stats.messages;

                // Actualizar tabla de usuarios recientes
                const users = data.data.recent_users;
                const tbody = document.getElementById('recentUsersTable');

                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center">No hay usuarios registrados</td></tr>';
                } else {
                    tbody.innerHTML = users.map(user => `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>
                                ${user.activo
                            ? '<span class="label label-success">Activo</span>'
                            : '<span class="label label-danger">Inactivo</span>'}
                            </td>
                            <td>${new Date(user.created_at).toLocaleDateString('es-ES')}</td>
                        </tr>
                    `).join('');
                }
            }
        }

        // Mostrar nombre de usuario
        function displayUserName() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (user.name) {
                document.getElementById('userName').textContent = user.name;
            }
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();

            await fetchAPI('/logout', { method: 'POST' });

            localStorage.removeItem('auth_token');
            localStorage.removeItem('user');
            window.location.href = '/app/login.html';
        });

        // Inicializar
        checkAuth();
        displayUserName();
        loadDashboard();
    </script>
</body>

</html>